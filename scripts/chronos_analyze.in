#!/bin/bash

# Check parameters
declare -r USAGE="\nUsage: $0 <interference config file> <l1 cache config file> <l2 cache config file> <number of cores> <TDMA schedule file> <DAG analysis type>\n\nThis script invokes the Chronos analyzer for the given benchmark and configuration."

if (( $# != 6 )); then
  echo -e $USAGE;
  exit 1;
fi;

declare    INTERFERENCE_FILE=$1
declare    L1_CACHE_CONFIG=$2
declare    L2_CACHE_CONFIG=$3
declare -i NUMBER_OF_CORES=$4
declare    TDMA_SCHEDULE_FILE=$5
declare    ANALYSIS_TYPE=$6

# Do the call
declare -r CALL_STRING="@CHRONOS_PATH@/m_cache/opt $INTERFERENCE_FILE $L1_CACHE_CONFIG $L2_CACHE_CONFIG $NUMBER_OF_CORES $TDMA_SCHEDULE_FILE $ANALYSIS_TYPE"

eval $CALL_STRING
if (( $? != 0 )); then
  echo "";
  echo "Analyzer failed! Call to reproduce was: ";
  echo $CALL_STRING;
fi;
